<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>

<body>
<h3>Avalanche!!!</h3>
<pre id="output"></pre>

<script>
    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }

    var slicedPath = location.pathname.split("/")
    $.post("/lines/" + slicedPath[slicedPath.length - 1] + "/turn", function( data ) {
        wsConnect(data);
    });

    function wsConnect(data) {
        var url = 'ws://localhost:12312/lines/' + data.resource + '/nextIn';
        c = new WebSocket(url);

        send = function (data) {
            $("#output").append((new Date()) + " ==> " + data + "\n");
            c.send(data)
        }

        c.onmessage = function (msg) {
            $("#output").append((new Date()) + " <== " + msg.data + "\n");
            var myTurn = Number(getCookie("av_t"));
            if (myTurn <= Number(msg.data)) {
                $("#output").append("My Turn!!!!!!");
                c.close();
            }

        }

        c.onopen = function () {
            send(".")
        }
    }
</script>

</body>
</html>